<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Memory Flip – Emoji Arcade v1</title>
<style>
  :root{
    --bg:#fff; --fg:#000; --accent:#000; --danger:#ff4c4c; --win:#00c853;
  }
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--fg);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    display:grid; place-items:center; overflow:hidden;
  }
  #wrap{ position:relative; width: min(100vw, 960px); height: min(100vh, 620px); }
  .hud{
    position:absolute; left:16px; top:12px; z-index:4; font-weight:600; letter-spacing:.4px;
  }
  .timerbar{
    position:absolute; left:0; right:0; top:0; height:8px; background:#ddd; overflow:hidden;
  }
  .timerbar>span{
    display:block; height:100%; width:100%; background:var(--fg); transform-origin:left center; transform:scaleX(1);
    transition:transform .25s linear, background .2s ease;
  }
  .board{
    position:absolute; inset:48px 16px 16px 16px; display:grid; gap:10px; align-content:center; justify-items:center;
  }
  .card{
    position:relative; width:100%; height:100%; perspective:800px; cursor:pointer;
  }
  .card-inner{
    width:100%; height:100%; position:absolute; transform-style:preserve-3d; transition:transform .28s ease;
  }
  .card.flipped .card-inner{ transform: rotateY(180deg) scale(1.02); }
  .card-face{
    position:absolute; inset:0; backface-visibility:hidden; border:2px solid var(--fg);
    border-radius:16px; display:grid; place-items:center; user-select:none;
  }
  .front{ background:var(--fg); color:var(--bg); font-weight:700; }
  .back{ background:var(--bg); color:var(--fg); transform:rotateY(180deg); font-size: clamp(28px, 6.2vmin, 48px); }
  .matched .back{ box-shadow:0 0 0 3px var(--win) inset, 0 0 18px rgba(0,0,0,.15); animation:pulse .5s ease; }
  @keyframes pulse{ 0%{transform:rotateY(180deg) scale(1)} 50%{transform:rotateY(180deg) scale(1.06)} 100%{transform:rotateY(180deg) scale(1)} }
  .shake{ animation:shake .28s ease; }
  @keyframes shake{ 0%,100%{ transform:translateX(0) } 25%{ transform:translateX(-6px) } 75%{ transform:translateX(6px) } }
  .menu, .overlay{
    position:absolute; inset:0; display:grid; place-items:center; text-align:center; z-index:6;
  }
  .menu-inner{
    display:grid; gap:14px; padding:24px; border:2px solid var(--fg); border-radius:20px;
    box-shadow: 0 10px 30px rgba(0,0,0,.08);
  }
  .title{ font-size:28px; font-weight:800; letter-spacing:.5px; }
  .buttons{ display:grid; grid-template-columns:1fr; gap:10px; }
  .btn{
    padding:12px 18px; border:2px solid var(--fg); border-radius:14px; background:#fff; color:#000;
    font-weight:700; cursor:pointer; transition:transform .08s ease, box-shadow .15s ease;
  }
  .btn:hover{ transform:translateY(-1px); box-shadow:0 6px 14px rgba(0,0,0,.1) }
  .btn:active{ transform:translateY(1px) }
  .overlay.backdrop{ background: rgba(0,0,0,.02); }
  .overlay .panel{
    padding:24px 28px; border:2px solid var(--fg); border-radius:18px; background:var(--bg);
    text-align:center; min-width:280px;
  }
  .overlay.red{ background: var(--danger); color:#000; }
  .overlay .subtitle{ opacity:.8; margin-top:6px; font-size:14px }
  .hint{ position:absolute; right:16px; bottom:12px; font-size:12px; opacity:.7; z-index:5 }
  /* Responsive board sizing via CSS variables set from JS */
</style>
</head>
<body>
  <div id="wrap">
    <div class="timerbar"><span id="timeFill"></span></div>
    <div class="hud">Time: <span id="timeText">--</span></div>
    <div id="board" class="board"></div>

    <!-- Menu -->
    <div id="menu" class="menu">
      <div class="menu-inner">
        <div class="title">Memory Flip – Emoji Arcade</div>
        <div>Select difficulty:</div>
        <div class="buttons">
          <button class="btn" data-mode="easy">Easy • 4×4 • 60s</button>
          <button class="btn" data-mode="medium">Medium • 5×4 • 90s</button>
          <button class="btn" data-mode="hard">Hard • 6×6 • 120s</button>
        </div>
        <div class="subtitle">Flip cards to match all pairs before time runs out.</div>
      </div>
    </div>

    <!-- Overlays -->
    <div id="win" class="overlay backdrop" style="display:none">
      <div class="panel">
        <div class="title">YOU WIN 🎉</div>
        <div class="subtitle">Press <b>R</b> to return to menu</div>
      </div>
    </div>

    <div id="lose" class="overlay red" style="display:none">
      <div class="panel" style="background:transparent; border-color:#000;">
        <div class="title">GAME OVER</div>
        <div class="subtitle">Press <b>R</b> to restart</div>
      </div>
    </div>

    <div class="hint">Press <b>R</b> to restart</div>
  </div>

<script>
// ====== Audio (WebAudio minimal beeps) ======
let actx=null;
function ensureAudio(){ if(!actx){ try{ actx = new (window.AudioContext||window.webkitAudioContext)(); }catch(e){} } }
function beep(freq=440, dur=0.1, type="sine", gain=0.06){
  if(!actx) return;
  const o = actx.createOscillator();
  const g = actx.createGain();
  o.type = type; o.frequency.value=freq;
  g.gain.value = gain;
  o.connect(g).connect(actx.destination);
  o.start(); o.stop(actx.currentTime+dur);
}
const sfx = {
  flip(){ beep(500, .07, "square", .06); },
  match(){
    beep(660, .07, "triangle", .07);
    setTimeout(()=>beep(880,.1,"triangle",.07), 70);
  },
  wrong(){
    beep(180,.12,"sawtooth",.06);
  },
  tickLow(){ beep(440,.04,"square",.045); },
  tickHigh(){ beep(880,.04,"square",.045); },
};

// ====== Game State ======
const boardEl = document.getElementById('board');
const menuEl  = document.getElementById('menu');
const winEl   = document.getElementById('win');
const loseEl  = document.getElementById('lose');
const timeText = document.getElementById('timeText');
const timeFill = document.getElementById('timeFill');

const EMOJIS = ["🍎","⭐","🎵","⚽","🎲","🚀","🐍","❤️","🍩","🔥","🌙","🎧","🐟","🌵","❄️","🎁","🧩","🍌","🍒","🧠","👾","🦴","🪐","💎","🐱","🐶","🦊","🦖","🍇","🥕","☕","📀","✏️","🧱","🧿","🔔","🔑"];

let cols=4, rows=4, totalPairs=8;
let timeTotal=60, timeLeft=60, timerId=null, running=false;
let first=null, lock=false, matchedCount=0;

// ====== Helpers ======
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

function pickEmojis(nPairs){
  const pool = shuffle([...EMOJIS]).slice(0, nPairs);
  return shuffle([...pool, ...pool]);
}

function buildBoard(mode){
  if(mode==="easy"){ cols=4; rows=4; timeTotal=60; }
  else if(mode==="medium"){ cols=5; rows=4; timeTotal=90; }
  else { cols=6; rows=6; timeTotal=120; }
  totalPairs = Math.floor((cols*rows)/2);

  boardEl.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
  boardEl.style.gridTemplateRows = `repeat(${rows}, 1fr)`;

  const deck = pickEmojis(totalPairs);
  boardEl.innerHTML = "";
  matchedCount = 0;
  first = null;
  lock = false;

  const frag = document.createDocumentFragment();
  deck.forEach((sym, idx)=>{
    const card = document.createElement('div');
    card.className = "card";
    card.dataset.symbol = sym;
    card.dataset.index = idx;

    const inner = document.createElement('div');
    inner.className = "card-inner";

    const front = document.createElement('div');
    front.className = "card-face front";
    const back = document.createElement('div');
    back.className = "card-face back";
    back.textContent = sym;

    inner.appendChild(front); inner.appendChild(back);
    card.appendChild(inner);
    card.addEventListener('click', onFlip);
    frag.appendChild(card);
  });
  boardEl.appendChild(frag);

  timeLeft = timeTotal;
  updateTimer(true);

  running = true;
  clearInterval(timerId);
  timerId = setInterval(tick, 1000);
}

function onFlip(e){
  if(!running) return;
  ensureAudio();
  const card = e.currentTarget;
  if(lock) return;
  if(card.classList.contains('flipped')) return;

  card.classList.add('flipped');
  sfx.flip();

  if(!first){
    first = card;
  }else{
    const a = first, b = card;
    if(a.dataset.symbol === b.dataset.symbol){
      a.classList.add('matched');
      b.classList.add('matched');
      sfx.match();
      matchedCount++;
      first = null;
      if(matchedCount >= totalPairs){
        win();
      }
    }else{
      lock = true;
      a.classList.add('shake');
      b.classList.add('shake');
      sfx.wrong();
      setTimeout(()=>{
        a.classList.remove('shake','flipped');
        b.classList.remove('shake','flipped');
        lock = false;
        first = null;
      }, 550);
    }
  }
}

function updateTimer(initial=false){
  timeText.textContent = `${timeLeft}s`;
  const ratio = Math.max(0, Math.min(1, timeLeft / timeTotal));
  timeFill.style.transform = `scaleX(${ratio})`;
  if(ratio <= .16){
    timeFill.style.background = 'var(--danger)';
  }else{
    timeFill.style.background = 'var(--fg)';
  }
  if(!initial){
    if(timeLeft <= 10) sfx.tickHigh(); else sfx.tickLow();
  }
}

function tick(){
  if(!running) return;
  timeLeft--;
  updateTimer();
  if(timeLeft <= 0){
    lose();
  }
}

function win(){
  running=false;
  clearInterval(timerId);
  winEl.style.display = "grid";
}

function lose(){
  running=false;
  clearInterval(timerId);
  loseEl.style.display = "grid";
}

function backToMenu(){
  running=false;
  clearInterval(timerId);
  winEl.style.display="none";
  loseEl.style.display="none";
  menuEl.style.display="grid";
  boardEl.innerHTML="";
  timeText.textContent="--";
  timeFill.style.transform="scaleX(1)";
  timeFill.style.background = 'var(--fg)';
}

document.addEventListener('keydown', (e)=>{
  if(e.key==='r' || e.key==='R'){
    backToMenu();
  }
});

menuEl.addEventListener('click', (e)=>{
  const btn = e.target.closest('[data-mode]');
  if(!btn) return;
  menuEl.style.display="none";
  const mode = btn.dataset.mode;
  buildBoard(mode);
});

menuEl.style.display="grid";
</script>
</body>
</html>
